<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>demo</title>
</head>
<body>
    <h1>测试1</h1>
    <input type="file" id="lrcFile" accept=".lrc" class="file-input">
    <button id="parseBtn">解析LRC文件</button>
    <script>
       const lrcFileInput = document.getElementById('lrcFile');
       document.getElementById('parseBtn')
       parseBtn.addEventListener('click', function() {
           const file = lrcFileInput.files[0];
           if (!file) {
               alert('请先选择LRC文件');
               return;
           }
           console.log("1");
           const reader = new FileReader();
           reader.onload = function(e) {
                    const lrcContent = e.target.result;
                    jsonlyrics = lrctojson(lrcContent);
           };
           console.log(lrcContent);
       });
       function lrctojson(lrc) {
       	const result = {
            metadata: {},
            lyrics: [],
            enhancelyrics: []
          };

          const lines = lrc.split('\n');
          const timeTagRegex = /^\[(\d+):(\d+)\.(\d+)\](.*)$/;
          const metadataRegex = /^\[(.*?):(.*)\]$/;
          console.log("2");
          //定义正则表达式
          let i = 1;
          for (const line of lines) {
          	if (!line.trim()) continue;
               const metadataMatch = line.match(metadataRegex);
               if (metadataMatch) {
                   result.metadata[metadataMatch[1].toLowerCase()] = metadataMatch[2];
                   continue;
               }
               //获取以及处理meta
               const timeMatch = line.match(timeTagRegex);
               if (timeMatch) {
                   const minutes = parseInt(timeMatch[1]);
                   const seconds = parseInt(timeMatch[2]);
                   const hundredths = parseInt(timeMatch[3]);
                   const text = timeMatch[4].trim();
               }
               const totalSeconds = minutes * 60 + seconds + hundredths / 100;//大部分为到百分位，有一些到千分位
               //获取和处理普通时间
               const pairlyricif = result.lyrics.findIndex(user => user.name === totalSeconds);
               if (pairlyricif != -1) {
               	result.lyrics[pairlyricif] = {
               		...result.lyrics[pairlyricif],
               		pairlyric: text
               	};
               	continue;
               }
               //处理副歌词
               adde = enhancelyricsprocessing(text,i);
               result.lyrics.push(adde)
               //处理增强版lrc格式
               if (text) {
                   text.replace(/<[^>]*>/g, '');
                   result.lyrics.push({
                       time: totalSeconds.toFixed(2),
                       text: text,
                       ordinal: i
                   });
               }
               i++;
          }
       console.log(result);
       return result;
       
       }  
       function enhancelyricsprocessing(te,i) {
           const regex = /<(\d+):(\d+)\.(\d+)>([^<]*)<(\d+):(\d+)\.(\d+)>/g;
           const result = [];
           let ttt;
           while ((ttt = regex.exec(te)) !== null) {
           	const totalSecondsStart = parseInt(ttt[1]) * 60 + parseInt(ttt[2]) + parseInt(ttt[3]) / 100;
           	const totalSecondsEnd = parseInt(ttt[5]) * 60 + parseInt(ttt[6]) + parseInt(ttt[7]) / 100;//大部分为到百分位，有一些到千分位
           	const Duration = totalSecondsEnd - totalSecondsStart;
               result.push({ ordinal: i, Duration: Duration, text: ttt[4] });
           }
           return result;
       }
    </script>
</body>
</html>