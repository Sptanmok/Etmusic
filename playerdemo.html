<!DOCTYPE html>
<html>
<head>
<style>
*{margin:0px;padding:0px;}
body{width:100%;height:100%;overflow:hidden;}
.box{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:center;margin:5px;padding:5px;-webkit-user-select:none;}
.box:hover{background-color:rgba(0,0,0,0.4);-webkit-box-shadow:0 0 5px #646464;cursor:pointer;}
.box:hover .ctrl{display:block;}
.text{position:relative;top:8px;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:center;font:normal normal bold 60px 微软雅黑,sans-serif;-webkit-filter:brightness(2);}
.text p{
	background:-webkit-linear-gradient(top, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0) 100%), -webkit-linear-gradient(left, #f00 0%, #00f 0%);
	-webkit-background-clip:text;
	-webkit-text-fill-color:transparent;
	/*-webkit-text-stroke:1px #f00;*/
	-webkit-filter:drop-shadow(0px 0px 1px #f00);
}
</style>
<meta charset="utf-8">
<title>demo</title>
</head>
<body>
    <div class="jumbotron">
      <div class="parent">
        <div class="text" type="lyric" id="lyric"></div>
      </div>
      <p type="text" id="pairlyric"></p>
      <br />
      <audio id="audio" src="Fra-Lippo-Lippi-Shouldnt-Have-To-Be-Like-That.mp3" controls style="width:100%"></audio>
    </div>
<script>
var _etext = document.getElementById("lyric");
function player(jsonlyrics){
	for (var i=0;i<=jsonlyrics.lyrics.length;i++){
	   if(audio.currentTime >= lyrics.lyrics[i].time){
	   	  for (var n=0;n<=jsonlyrics.lyrics[i].etext.length;n++){
	   	  	 ps += '<p id="' + i + '">' + jsonlyrics.lyrics[i].etext[n]['text'] + "</p>";
	   	  }
	   	  _etext.innerHTML = ps;
	   	  for (var m=0;m<=jsonlyrics.lyrics[i].etext.length;m++){
	   	  	if(audio.currentTime >= jsonlyrics.lyrics[i].etext[m].start){
	   	  		for(var u=0;audio.currentTime >= jsonlyrics.lyrics[i].etext[m].end){
	   	  		    _process = ( audio.currentTime - jsonlyrics.lyrics[i].etext[m].start ) / jsonlyrics.lyrics[i].etext[m].Duration * 100
	   	  		    _etext.getElementsByTagName("p")[m].style.backgroundImage = "-webkit-linear-gradient(top, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0) 100%), -webkit-linear-gradient(left, #f00 " + _process + "%, #00f 0%)";
	   	  		}
	   	  	}
	   	  }
	   }
	}
}
function eplayer(elrc, etext){
	_ep = _eps[_index];
	if (count >= pos) {
		_process += _ps;
		_ep.style.backgroundImage = "-webkit-linear-gradient(top, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0) 100%), -webkit-linear-gradient(left, #f00 " + _process + "%, #00f 0%)";
		
		if (_process >= 99) {
			if ((_index+1) >= _eps.length) {
				return;
			}
			_index++;
			var ts = Math.round(_eps[_index].duration/step)==0?1:Math.round(_eps[_index].duration/step);
			_ps = 100/ts;
			_process = 0;
			pos = Math.round(_eps[_index].offset/step);
		}
	}
	count++;
	timer = setTimeout(_processw.bind(this, _eps, _index, _ps, _process, pos, count), step);
}
       fetch('./fdhhdh.json')
        .then(response => response.json())
        .then(jsonlyrics => {
        console.log(jsonlyrics);
        player(jsonlyrics);
        })
        .catch(error => {
        console.error('加载失败:', error);
        });
_eps = jsonlyrics.lyrics
var wstoes = function(words) {
	var ps = "";
	for (var i = 0; i < words.length; i++) {
		ps += "<p>" + words[i]['w'] + "</p>";
	}
	_etext.innerHTML = ps;

	var _eps = _etext.getElementsByTagName("p");
	for (var i = 0; i < words.length; i++) {
		_eps[i].offset = words[i]['o'];
		_eps[i].duration = words[i]['d'];
	}
	return _eps;
}
var step = 30;
var timer;
var _processw = function(_eps, _index, _ps, _process, pos, count){
	_ep = _eps[_index];
	if (count >= pos) {
		_process += _ps;
		_ep.style.backgroundImage = "-webkit-linear-gradient(top, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0) 100%), -webkit-linear-gradient(left, #f00 " + _process + "%, #00f 0%)";
		
		if (_process >= 99) {
			if ((_index+1) >= _eps.length) {
				return;
			}
			_index++;
			var ts = Math.round(_eps[_index].duration/step)==0?1:Math.round(_eps[_index].duration/step);
			_ps = 100/ts;
			_process = 0;
			pos = Math.round(_eps[_index].offset/step);
		}
	}
	count++;
	timer = setTimeout(_processw.bind(this, _eps, _index, _ps, _process, pos, count), step);
}
</script>
</body>
</html>
