<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="player.css">
<meta charset="utf-8">
<title>demo</title>
</head>
<body>
    <div class="main">
      <div>
        <h1 class="text shake-text" type="lyric" id="lyric"></h1>
      </div>
      <p type="text" id="pairlyric"></p>
      <br />
	  <canvas id="spectrum" width="800" height="200"></canvas>
	  <div class="player">
        <audio id="audio" src="https://music.emnasop.cn/CountingStars-OneRepublic.mp3" controls style="width:100%" lyricpath="./CountingStars-OneRepublic.json"></audio>
      </div>
    </div>
<script src="player.js"></script>
<script>
// 获取页面中的音频和画布元素
const canvas = document.getElementById('spectrum');
const ctx = canvas.getContext('2d');

// 创建音频上下文
const audioContext = new (window.AudioContext || window.webkitAudioContext)();

// 创建音频分析器
const analyser = audioContext.createAnalyser();
analyser.fftSize = 256; // 设置频谱的大小
const bufferLength = analyser.frequencyBinCount; // 获取频谱条数量
const dataArray = new Uint8Array(bufferLength);
const source = audioContext.createMediaElementSource(audio);
source.connect(analyser);
analyser.connect(audioContext.destination);
function drawSpectrum() {
  requestAnimationFrame(drawSpectrum);

  analyser.getByteFrequencyData(dataArray);

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const barWidth = (canvas.width / bufferLength) * 2.5;
  let barHeight;
  let x = 0;

  for (let i = 0; i < bufferLength; i++) {
    barHeight = dataArray[i];
    const r = barHeight + (25 * (i / bufferLength));
    const g = 250 * (i / bufferLength);
    const b = 50;
    
    ctx.fillStyle = `rgb(${r},${g},${b})`;
    ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);

    x += barWidth + 1;
  }
}

audio.onplay = () => {
  audioContext.resume().then(() => {
    drawSpectrum();
  });
};
</script>
</body>
</html>
