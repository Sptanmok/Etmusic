<!DOCTYPE html>
<html>
<head>
<style>
*{margin:0px;padding:0px;}
body{width:100%;height:100%;overflow:hidden;}
.box{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:center;margin:5px;padding:5px;-webkit-user-select:none;}
.box:hover{background-color:rgba(0,0,0,0.4);-webkit-box-shadow:0 0 5px #646464;cursor:pointer;}
.box:hover .ctrl{display:block;}
.text{position:relative;top:8px;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:center;font:normal normal bold 60px 微软雅黑,sans-serif;-webkit-filter:brightness(2);}
.text p{
	background:-webkit-linear-gradient(top, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0) 100%), -webkit-linear-gradient(left, #f00 0%, #00f 0%);
	-webkit-background-clip:text;
	-webkit-text-fill-color:transparent;
	/*-webkit-text-stroke:1px #f00;*/
	-webkit-filter:drop-shadow(0px 0px 1px #f00);
}
</style>
<meta charset="utf-8">
<title>demo</title>
</head>
<body>
    <div class="jumbotron">
      <div class="parent">
        <div class="text" type="lyric" id="lyric"></div>
      </div>
      <p type="text" id="pairlyric"></p>
      <br />
      <audio id="audio" src="Fra-Lippo-Lippi-Shouldnt-Have-To-Be-Like-That.mp3" controls style="width:100%"></audio>
    </div>
<script>
const audio = document.getElementById('audio');
let currentLyricIndex = -1;
let wordElements = [];
var _etext = document.getElementById("lyric");
const lyricElement = document.getElementById('lyric');
const pairLyricElement = document.getElementById('pairlyric');
fetch('./fdhhdh.json')
  .then(response => {
    if (!response.ok) {
      throw new Error('json response was not ok');
    }
    return response.json();
  })
  .then(data => {
    jsonlyrics = data;
    console.log(jsonlyrics);
	initLyrics();
  })
function initLyrics() {//初始化
    audio.addEventListener('timeupdate', function() {
        updateLyrics(jsonlyrics);
    });
}
function updateLyrics() {
    const currentTime = audio.currentTime;
                
    let newIndex = -1;
    for (let i = 0; i < jsonlyrics.lyrics.length; i++) {
        if (currentTime >= jsonlyrics.lyrics[i].time) {
            newIndex = i;
        } else {
            break;
       }
    }
                
    if (newIndex !== currentLyricIndex && newIndex !== -1) {
        currentLyricIndex = newIndex;
        displayCurrentLyric();
    }
                
    if (currentLyricIndex !== -1) {
        highlightWords(currentTime);
    }
}
function displayCurrentLyric() {
    const currentLyric = jsonlyrics.lyrics[currentLyricIndex];
    let html = '';
    
    for (let i = 0; i < currentLyric.etext.length; i++) {
        html += `<span style="--progress:0%">${currentLyric.etext[i].text}</p>`;
    }
        lyricElement.innerHTML = html;
    wordElements = lyricElement.getElementsByTagName('span');
    pairLyricElement.textContent = currentLyric.pairlyric;
}
function highlightWords(currentTime) {
    const currentLyric = jsonlyrics.lyrics[currentLyricIndex];
                
    for (let i = 0; i < currentLyric.etext.length; i++) {
        const word = currentLyric.etext[i];
        
        if (currentTime >= word.start && currentTime <= word.end) {
            const progress = ((currentTime - word.start) / word.Duration) * 100;
            if (wordElements[i]) {
                wordElements[i].style.setProperty('--progress', `${progress}%`);
            }
        } else if (currentTime > word.end && wordElements[i]) {
            wordElements[i].style.setProperty('--progress', '100%');
        } else if (wordElements[i]) {
            wordElements[i].style.setProperty('--progress', '0%');
        }
    }
}
function eplayer(elrc, etext){
	_ep = _eps[_index];
	if (count >= pos) {
		_process += _ps;
		_ep.style.backgroundImage = "-webkit-linear-gradient(top, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0) 100%), -webkit-linear-gradient(left, #f00 " + _process + "%, #00f 0%)";
		
		if (_process >= 99) {
			if ((_index+1) >= _eps.length) {
				return;
			}
			_index++;
			var ts = Math.round(_eps[_index].duration/step)==0?1:Math.round(_eps[_index].duration/step);
			_ps = 100/ts;
			_process = 0;
			pos = Math.round(_eps[_index].offset/step);
		}
	}
	count++;
	timer = setTimeout(_processw.bind(this, _eps, _index, _ps, _process, pos, count), step);
}

</script>
</body>
</html>
